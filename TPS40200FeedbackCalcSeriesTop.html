<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TPS40200 Feedback Resistor Selector</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900 min-h-screen p-6">
  <div class="max-w-5xl mx-auto bg-white shadow-xl rounded-2xl p-8">
    <h1 class="text-2xl font-bold text-blue-700 mb-4 text-center">TPS40200 Feedback Resistor Optimizer (Series Top)</h1>

    <!-- Vout Input with Slider -->
    <div class="mb-6">
      <label class="font-medium block mb-1">Target Output Voltage (V<sub>out</sub>):</label>
      <div class="flex items-center space-x-4">
        <input type="range" id="voutSlider" min="20" max="100" step="0.01" value="28.75" class="w-full">
        <input type="number" id="voutTarget" value="28.75" step="0.01" min="20" max="100" class="w-28 p-1 border rounded">
      </div>
    </div>

    <!-- Editable Resistor List -->
    <div class="mb-6">
      <label class="font-semibold block mb-2">Enter Resistor Values (kŒ©), comma-separated:</label>
      <textarea id="resistorListInput" class="w-full h-24 p-2 border rounded text-sm bg-gray-50">324, 576, 1000, 1500, 243, 240, 200, 187, 60.4, 62, 100, 115, 124, 270, 52.3, 47, 27, 30, 32.4, 18.2, 14.3, 7.15, 7.5, 8.06, 10, 3.57, 3.32, 3</textarea>
      <div class="mt-2 space-x-2">
        <button onclick="calculateSeriesRtopOptions()" class="bg-blue-600 text-white font-semibold px-4 py-2 rounded hover:bg-blue-700">
          üîç Find Best Series R<sub>top</sub> + Single R<sub>bottom</sub>
        </button>
        <button onclick="document.getElementById('resistorListInput').value = ''" class="bg-gray-400 text-white font-semibold px-4 py-2 rounded hover:bg-gray-500">
          üßπ Clear Resistor List
        </button>
      </div>
    </div>

    <div id="seriesResult" class="mt-8">
      <h2 class="text-xl font-semibold mb-4">Best Matches:</h2>
      <div id="seriesMatchList" class="text-sm font-mono text-gray-800"></div>
    </div>
  </div>

  <script>
    const vref = 0.7;

    function parseResistorList() {
      const raw = document.getElementById("resistorListInput").value;
      return raw.split(',').map(r => parseFloat(r.trim())).filter(r => !isNaN(r));
    }

    function calculateSeriesRtopOptions() {
      const targetVout = parseFloat(document.getElementById("voutTarget").value);
      if (isNaN(targetVout) || targetVout <= 0) return;

      const voutMin = targetVout - 0.25;
      const voutMax = targetVout + 0.25;
      const resistorList = parseResistorList();
      let bestResults = [];

      for (let i = 0; i < resistorList.length; i++) {
        for (let j = 0; j < resistorList.length; j++) {
          const rtop = resistorList[i] + resistorList[j];
          for (let k = 0; k < resistorList.length; k++) {
            const rbot = resistorList[k];
            const vout = vref * (1 + rtop / rbot);
            if (vout >= voutMin && vout <= voutMax) {
              bestResults.push({ rtop1: resistorList[i], rtop2: resistorList[j], rbot, vout });
            }
          }
        }
      }

      bestResults.sort((a, b) => Math.abs(a.vout - targetVout) - Math.abs(b.vout - targetVout));
      const topResults = bestResults.slice(0, 5);
      const display = topResults.map(r => `
        <div class="mb-4 p-3 border rounded bg-gray-50">
          <strong>V<sub>out</sub>:</strong> ${r.vout.toFixed(2)} V<br/>
          <strong>R<sub>top</sub>:</strong> ${r.rtop1}‚ÄØkŒ© + ${r.rtop2}‚ÄØkŒ© = ${(r.rtop1 + r.rtop2).toFixed(2)}‚ÄØkŒ©<br/>
          <strong>R<sub>bottom</sub>:</strong> ${r.rbot.toFixed(2)}‚ÄØkŒ©
        </div>
      `).join("");
      document.getElementById("seriesMatchList").innerHTML = display || '<p class="text-red-600">No valid combinations found in target range.</p>';
    }

    // Sync Vout slider and input
    document.addEventListener("DOMContentLoaded", () => {
      const voutSlider = document.getElementById("voutSlider");
      const voutInput = document.getElementById("voutTarget");

      voutSlider.addEventListener("input", () => {
        voutInput.value = parseFloat(voutSlider.value).toFixed(2);
      });
      voutInput.addEventListener("input", () => {
        voutSlider.value = voutInput.value;
      });
    });
  </script>
</body>
</html>
